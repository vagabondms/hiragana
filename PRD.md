# 히라가나 학습 앱 - Product Requirements Document (PRD)

## 1. 프로젝트 개요
히라가나 문자를 학습하기 위한 웹 기반 플래시카드 애플리케이션

## 2. 핵심 기능 요구사항

### 2.1 카드 시스템
- **카드 구조**: 앞면(한국어) / 뒷면(일본어/히라가나)
- **학습 플로우**:
  1. 초기 상태: 한국어 표시 (카드 앞면)
  2. 첫 번째 클릭/터치: 카드 180도 뒤집기 → 일본어 표시 (카드 뒷면)
  3. 두 번째 클릭/터치: 다음 문제로 전환 (카드 슬라이드 애니메이션)

### 2.2 애니메이션 요구사항
- **카드 플립 애니메이션** (한국어 → 일본어):
  - 180도 Y축 회전
  - 부드러운 3D 전환 효과

- **카드 슬라이드 애니메이션** (일본어 → 다음 한국어):
  - 현재 카드: 일본어가 보이는 상태로 오른쪽으로 슬라이드 아웃
  - 새 카드: 한국어가 보이는 상태로 왼쪽에서 슬라이드 인
  - 두 카드가 독립적으로 관리되어야 함 (dual-card system)

### 2.3 랜덤 알고리즘 - 카드 덱 방식
- **컨셉**: 트럼프 카드를 뽑듯이, 한 번 나온 글자는 모두 소비할 때까지 다시 나오지 않음
- **동작 방식**:
  - 사용 가능한 모든 글자를 "카드 덱"으로 관리
  - 글자를 선택하면 "사용됨" 목록에 추가 (카드를 버림)
  - 남은 글자 중에서만 랜덤 선택
  - 모든 글자를 소비하면 덱을 다시 채움 (카드 리셔플)
- **장점**:
  - 각 글자가 균등하게 노출됨
  - 한 세션 내에서 모든 글자를 정확히 한 번씩 학습
  - 예측 가능한 학습 진행도
- **초기화 시점**:
  - 설정 변경 시
  - 페이지 새로고침 시
  - 모든 글자 소비 완료 시

### 2.4 입력 처리
- **지원 입력 방식**:
  - 스페이스바 (데스크톱)
  - 마우스 클릭
  - 터치 (모바일)

- **애니메이션 잠금**:
  - 카드 플립 중 입력 차단 (600ms)
  - 카드 슬라이드 중 입력 차단 (300ms)
  - isAnimating 플래그로 관리

## 3. 모바일 최적화

### 3.1 반응형 디자인
- **브레이크포인트**:
  - 768px 이하: 태블릿 대응
    - 카드 크기: 90vw (최대 350px)
    - 글자 크기: 80px
  - 480px 이하: 모바일 대응
    - 카드 크기: 90vw (최대 300px)
    - 글자 크기: 60px

- **텍스트 처리**:
  - white-space: nowrap으로 줄바꿈 방지
  - 모바일에서도 한 줄로 표시

### 3.2 터치 이벤트
- 모든 인터랙티브 요소에 터치 이벤트 추가
- preventDefault()로 기본 동작 방지
- 설정 버튼, 모달, 카드 모두 터치 지원

## 4. 설정 기능

### 4.1 개별 글자 선택 기능
- **학습할 글자를 개별적으로 선택 가능**
- 각 행(A, K, S, T, N, H, M, Y, R, W) 앞에 "행 전체 선택" 체크박스 제공
- **행 선택 동작**:
  - 행 체크박스 선택 시 → 해당 행의 모든 글자 자동 선택
  - 해당 행의 글자를 하나라도 선택 해제 시 → 행 체크박스 자동 해제
  - 해당 행의 모든 글자를 수동으로 선택 시 → 행 체크박스 자동 선택
- **글자 표시 방식**: 영어 발음으로 표시
  - A행: a, i, u, e, o
  - K행: ka, ki, ku, ke, ko
  - S행: sa, si, su, se, so
  - T행: ta, chi, tsu, te, to (특수 발음)
  - N행: na, ni, nu, ne, no
  - H행: ha, hi, fu, he, ho (특수 발음)
  - M행: ma, mi, mu, me, mo
  - Y행: ya, yu, yo (3개만)
  - R행: ra, ri, ru, re, ro
  - W행: wa, wo, n (3개, 특수)
- **저장**: 선택된 글자 정보는 localStorage에 저장
- **검증**: 최소 1개 이상의 글자 선택 필수
- **기본값**: 처음 사용 시 모든 글자 선택됨

**데이터 구조**:
```javascript
// localStorage에 저장되는 형식
selectedCharacters = {
  hiragana: {
    A: [true, true, false, true, true],  // a, i, u, e, o 중 u 제외
    K: [true, true, true, true, true],    // 전체 선택
    Y: [true, false, true],               // ya, yo만 선택 (yu 제외)
    // ... 기타 행
  },
  katakana: {
    A: [true, true, true, true, true],
    // ... 기타 행
  }
}
```

### 4.2 문자 체계 선택 기능
- 히라가나/가타카나 체크박스 추가
- 복수 선택 가능, 최소 1개 이상 선택 필수
- 기존 행 선택 UI와 동일한 디자인 패턴 사용
- localStorage에 선택 상태 저장

### 4.3 카드 문자 체계 표시
- 카드 앞면(한글 표시 부분) 우측 상단에 문자 체계 배지 표시
- "히" (히라가나) 또는 "가" (가타카나)로 구분
- 사용자가 카드를 뒤집기 전에 어떤 문자 체계를 학습할지 미리 확인 가능

## 5. 기술 구현 세부사항

### 5.1 상태 관리
```javascript
// 글로벌 상태
- state: 'initial' | 'korean' | 'hiragana'
- activeCard: 1 | 2 (현재 활성 카드)
- card1State: 'front' | 'back'
- card2State: 'front' | 'back'
- isAnimating: boolean (애니메이션 잠금)
- recentHistory: array (최근 나온 글자들)
```

### 5.2 CSS 클래스 구조
```css
.card.flipped              // 카드 뒤집힘 상태
.card.flipped.slide-out-flipped  // 일본어 보이며 슬라이드 아웃
.card.slide-in             // 한국어 보이며 슬라이드 인
```

### 5.3 Transform 순서 중요
```css
/* 올바른 순서 - translateX 먼저, rotateY 나중 */
transform: translateX(100%) rotateY(180deg);
```

## 6. Git 관리
- Remote repository: `git@personal:vagabondms/hiragana.git`
- 모든 변경사항은 commit 후 push
- Commit 메시지에 Co-Authored-By 포함

## 7. 주요 버그 및 해결사항

### 7.1 카드 전환 시 텍스트 문제
- **문제**: 슬라이드 아웃하는 카드에 한국어가 보임
- **원인**: 두 카드가 같은 상태를 공유
- **해결**: Dual-card system으로 각 카드 독립적 관리

### 7.2 CSS Transform 충돌
- **문제**: animation transform이 기존 transform 덮어씀
- **해결**: 올바른 transform 순서 적용 및 CSS 선택자 특이도 조정

## 8. 향후 개선사항 (Out of Scope)
- 학습 진행도 추적
- 틀린 문제 재학습
- 발음 오디오 재생
- 다른 일본어 문자 추가 (카타카나, 한자)